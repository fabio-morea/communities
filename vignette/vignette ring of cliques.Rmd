---
title: "communities library - Rings of Cliques"
output:
  pdf_document: default
  html_notebook: default
vignette: >
 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>", fig.width = 6, fig.height = 4)
set.seed(123) # reproducibility for layouts only
```

## Overview

This vignette shows how to create **Ring-of-Cliques (ROC)** test graphs using `make_ring_of_cliques()` with four variants:

-   **RC**
-   **RC_B** — ring bridges between adjacent cliques
-   **RC_C** — one central node connected to each clique
-   **RC_BC** — both ring bridges **and** central node

Each clique is a ground-truth community. The function annotates vertices with: - `gt_community` (numeric), `gt_label` (character), - `clique_id`, `within_id`, - role flags (`role`, `is_bridge_endpoint`, `is_center_endpoint`).

Graphs are constructed deterministically: all clique vertices come first, the optional center (if any) is last.

------------------------------------------------------------------------

## Quick start

```{r}

library(tidyverse)
library(knitr)   # for kable()
library(igraph)
library(communities)
```

```{r}

g  <- communities::make_ring_of_cliques(
    n_cliques = 4,
    clique_size = 10,
    variant = "RC"
)

plot(
  g,
  vertex.color = degree(g),
  vertex.label = NA,
  vertex.size = 15,
  edge.color = "grey70",
)
```

```{r}
g  <- communities::make_ring_of_cliques(
    n_cliques = 4,
    clique_size = 8,
    variant = "RC_C"
)

plot(
  g,
  vertex.color = degree(g),
  vertex.label = NA,
  vertex.size = 10,
  edge.color = "grey70",
)

```

```{r}

g  <- communities::make_ring_of_cliques(
    n_cliques = 4,
    clique_size = 10,
    variant = "RC_B"
)

plot(
  g,
  vertex.color = degree(g),
  vertex.label = NA,
  vertex.size = 15,
  edge.color = "grey70",
)
```

```{r}

g  <- communities::make_ring_of_cliques(
    n_cliques = 6,
    clique_size = 8,
    variant = "RC_BC"
)

plot(
  g,
  vertex.color = degree(g),
  vertex.label = NA,
  vertex.size = 10,
  edge.color = "grey70",
)
```

```         
```

------------------------------------------------------------------------

## Ground-truth labels

Each clique is assigned to a "truth community"; outliers are assigned to community "0":

```{r}
g  <- communities::make_ring_of_cliques(
    n_cliques = 6,
    clique_size = 8,
    variant = "RC_BC"
)
# Each node belongs to a community identified by its "gt_community" attribute.
# Here we count how many nodes are in each community.
comm_dist <- tibble(
  community = V(g)$gt_community
) %>%
  count(community, name = "n_nodes") %>%
  arrange(desc(n_nodes))

kable(comm_dist, caption = "Distribution of ground-truth communities")



```

```{r}
# --- Outlier nodes (if present) ---
# Nodes with gt_community = 0 are considered outliers and are labelled "CENTRAL".
# We extract and display only these nodes for inspection.
outliers <- tibble(
  node = V(g)$name,
  community = V(g)$gt_community
) %>%
  filter(community == 0)

kable(outliers, caption = "List of outlier nodes (community = 0)")
```

You can inspect roles and edge types:

```{r}
sort(table(V(g)$role))
sort(table(E(g)$edge_type))
```

## Takeaways

-   Each clique is annotated with a unique ground-truth label.
-   Variants (RC_B, RC_C, RC_BC) change the meso-structure without altering the inner cliques.
-   The construction is deterministic and idempotent: given the same parameters, you always obtain the same graph structure and vertex order.

This makes the functions suitable for benchmarking community detection algorithms under controlled conditions.


